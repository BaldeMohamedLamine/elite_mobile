{% extends 'manager/base.html' %}
{% load static %}

{% block navbar_title %}{{ title }}{% endblock %}
{% block header_title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8 gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-layer-group text-primary mr-3"></i>
                {{ title }}
            </h1>
            <p class="text-gray-600">
                {% if object %}
                    Modifiez les informations de cette variante
                {% else %}
                    Créez une nouvelle variante pour ce produit
                {% endif %}
            </p>
        </div>
        
        <div class="flex gap-3">
            <a href="/products/variants/product/{{ product.uid }}/" 
               class="btn btn-outline hover-glow transition-all">
                <i class="fas fa-arrow-left mr-2"></i>
                Retour aux variantes
            </a>
        </div>
    </div>

    <!-- Informations du produit -->
    <div class="card bg-base-100 shadow-xl mb-8">
        <div class="card-body">
            <div class="flex items-center space-x-4">
                <div class="avatar">
                    <div class="mask mask-squircle w-16 h-16">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}">
                        {% else %}
                            <div class="bg-gray-200 flex items-center justify-center">
                                <i class="fas fa-image text-gray-400 text-2xl"></i>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold">{{ product.name }}</h3>
                    <p class="text-gray-600">{{ product.category.name|default:"Sans catégorie" }}</p>
                    <p class="text-sm text-gray-500">SKU: {{ product.sku|default:"N/A" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulaire -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Formulaire principal -->
        <div class="lg:col-span-2">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" class="space-y-6">
                        {% csrf_token %}
                        
                        <!-- Informations de base -->
                        <div class="form-section">
                            <h3 class="text-xl font-semibold mb-4 text-primary">
                                <i class="fas fa-info-circle mr-2"></i>
                                Informations de la variante
                            </h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Nom de la variante *</span>
                                    </label>
                                    {{ form.name }}
                                    {% if form.name.errors %}
                                        <div class="text-error text-sm mt-1">{{ form.name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Type de variante *</span>
                                    </label>
                                    {{ form.variant_type }}
                                    {% if form.variant_type.errors %}
                                        <div class="text-error text-sm mt-1">{{ form.variant_type.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-control mt-4">
                                <label class="label">
                                    <span class="label-text font-medium">Description</span>
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <div class="text-error text-sm mt-1">{{ form.description.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Prix et stock -->
                        <div class="form-section">
                            <h3 class="text-xl font-semibold mb-4 text-primary">
                                <i class="fas fa-dollar-sign mr-2"></i>
                                Prix et stock
                            </h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Prix de vente</span>
                                    </label>
                                    <div class="relative">
                                        {{ form.price }}
                                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">GNF</span>
                                    </div>
                                    {% if form.price.errors %}
                                        <div class="text-error text-sm mt-1">{{ form.price.errors.0 }}</div>
                                    {% endif %}
                                    <div class="text-sm text-gray-500 mt-1">
                                        Laissez vide pour utiliser le prix du produit principal
                                    </div>
                                </div>
                                
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Stock initial *</span>
                                    </label>
                                    {{ form.quantity }}
                                    {% if form.quantity.errors %}
                                        <div class="text-error text-sm mt-1">{{ form.quantity.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Stock minimum</span>
                                    </label>
                                    {{ form.min_stock_level }}
                                    {% if form.min_stock_level.errors %}
                                        <div class="text-error text-sm mt-1">{{ form.min_stock_level.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Codes et identification -->
                        <div class="form-section">
                            <h3 class="text-xl font-semibold mb-4 text-primary">
                                <i class="fas fa-barcode mr-2"></i>
                                Codes et identification
                            </h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Code SKU</span>
                                    </label>
                                    {{ form.sku }}
                                    {% if form.sku.errors %}
                                        <div class="text-error text-sm mt-1">{{ form.sku.errors.0 }}</div>
                                    {% endif %}
                                    <div class="text-sm text-gray-500 mt-1">
                                        Généré automatiquement si vide
                                    </div>
                                </div>
                                
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text font-medium">Code-barres</span>
                                    </label>
                                    {{ form.barcode }}
                                    {% if form.barcode.errors %}
                                        <div class="text-error text-sm mt-1">{{ form.barcode.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Images -->
                        <div class="form-section">
                            <h3 class="text-xl font-semibold mb-4 text-primary">
                                <i class="fas fa-images mr-2"></i>
                                Images de la variante
                            </h3>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-medium">Image principale</span>
                                </label>
                                {{ form.image }}
                                {% if form.image.errors %}
                                    <div class="text-error text-sm mt-1">{{ form.image.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Statut et options -->
                        <div class="form-section">
                            <h3 class="text-xl font-semibold mb-4 text-primary">
                                <i class="fas fa-cog mr-2"></i>
                                Statut et options
                            </h3>
                            
                            <div class="form-control">
                                <label class="label cursor-pointer">
                                    {{ form.is_active }}
                                    <span class="label-text font-medium ml-2">Variante active</span>
                                </label>
                                <div class="text-sm text-gray-500">La variante sera visible dans le catalogue</div>
                            </div>
                        </div>

                        <!-- Boutons d'action -->
                        <div class="flex justify-end gap-4 pt-6 border-t">
                            <a href="/products/variants/product/{{ product.uid }}/" 
                               class="btn btn-outline">
                                <i class="fas fa-times mr-2"></i>
                                Annuler
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                {{ submit_text }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar avec aide -->
        <div class="lg:col-span-1">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h3 class="card-title text-primary">
                        <i class="fas fa-lightbulb mr-2"></i>
                        Conseils
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <div class="font-semibold">Types de variantes</div>
                                <div class="text-sm">Couleur, Taille, Matériau, etc.</div>
                            </div>
                        </div>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <div class="font-semibold">Prix de la variante</div>
                                <div class="text-sm">Si vide, utilise le prix du produit principal</div>
                            </div>
                        </div>
                        
                        <div class="alert alert-success">
                            <i class="fas fa-chart-line"></i>
                            <div>
                                <div class="font-semibold">Gestion des stocks</div>
                                <div class="text-sm">Chaque variante a son propre stock</div>
                            </div>
                        </div>
                        
                        <div class="alert alert-primary">
                            <i class="fas fa-image"></i>
                            <div>
                                <div class="font-semibold">Images</div>
                                <div class="text-sm">Ajoutez des images spécifiques à cette variante</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.form-section {
    @apply border-b border-gray-200 pb-6 mb-6;
}

.form-section:last-child {
    @apply border-b-0 pb-0 mb-0;
}

.alert {
    @apply p-3 rounded-lg;
}

.alert-info {
    @apply bg-blue-50 border border-blue-200 text-blue-800;
}

.alert-warning {
    @apply bg-yellow-50 border border-yellow-200 text-yellow-800;
}

.alert-success {
    @apply bg-green-50 border border-green-200 text-green-800;
}

.alert-primary {
    @apply bg-purple-50 border border-purple-200 text-purple-800;
}
</style>
{% endblock %}
