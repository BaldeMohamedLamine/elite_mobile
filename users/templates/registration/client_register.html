{% extends 'base.html' %}
{% load static %}

{% block title %}Inscription - Boutique{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-primary/10 via-base-100 to-secondary/10 flex items-center justify-center p-4">
  <div class="card w-full max-w-2xl shadow-2xl bg-base-100">
    <div class="card-body">
      <!-- Header -->
      <div class="text-center mb-6">
        <div class="avatar placeholder mb-4">
          <div class="bg-primary text-primary-content rounded-full w-16">
            <i class="fas fa-user-plus text-2xl"></i>
          </div>
        </div>
        <h1 class="text-4xl font-bold text-primary">Créer un compte</h1>
        <p class="text-base-content/70 mt-2">Rejoignez notre communauté et découvrez nos produits</p>
      </div>

      <!-- Messages -->
      {% if messages %}
        <div class="space-y-2 mb-4">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags|default:'info' }}" role="alert">
              <i class="fas fa-info-circle"></i>
              <span>{{ message }}</span>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Form Errors -->
      {% if form.errors %}
        <div class="alert alert-error mb-4" role="alert">
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <div class="font-medium">Erreurs détectées</div>
            <div class="text-sm">Veuillez corriger les erreurs ci-dessous</div>
          </div>
        </div>
      {% endif %}

      <!-- Registration Form -->
      <form action="{% url 'users:register' %}" method="post" class="space-y-6">
        {% csrf_token %}
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- First Name -->
          <div class="form-control">
            <label class="label" for="{{ form.first_name.id_for_label }}">
              <span class="label-text font-medium">
                <i class="fas fa-user mr-2"></i>{{ form.first_name.label }}
              </span>
            </label>
            <input 
              id="{{ form.first_name.id_for_label }}" 
              type="text" 
              name="{{ form.first_name.name }}" 
              autocomplete="given-name" 
              class="input input-bordered w-full {% if form.first_name.errors %}input-error{% endif %}"
              value="{{ form.first_name.value|default_if_none:'' }}"
              placeholder="Votre prénom"
              required
            />
            {% if form.first_name.errors %}
              <div class="label">
                {% for error in form.first_name.errors %}
                  <span class="label-text-alt text-error">
                    <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
                  </span>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <!-- Last Name -->
          <div class="form-control">
            <label class="label" for="{{ form.last_name.id_for_label }}">
              <span class="label-text font-medium">
                <i class="fas fa-user mr-2"></i>{{ form.last_name.label }}
              </span>
            </label>
            <input 
              id="{{ form.last_name.id_for_label }}" 
              type="text" 
              name="{{ form.last_name.name }}" 
              autocomplete="family-name" 
              class="input input-bordered w-full {% if form.last_name.errors %}input-error{% endif %}"
              value="{{ form.last_name.value|default_if_none:'' }}"
              placeholder="Votre nom"
              required
            />
            {% if form.last_name.errors %}
              <div class="label">
                {% for error in form.last_name.errors %}
                  <span class="label-text-alt text-error">
                    <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
                  </span>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Email -->
        <div class="form-control">
          <label class="label" for="{{ form.email.id_for_label }}">
            <span class="label-text font-medium">
              <i class="fas fa-envelope mr-2"></i>{{ form.email.label }}
            </span>
          </label>
          <input 
            id="{{ form.email.id_for_label }}" 
            type="email" 
            name="{{ form.email.name }}" 
            autocomplete="email" 
            class="input input-bordered w-full {% if form.email.errors %}input-error{% endif %}"
              value="{{ form.email.value|default_if_none:'' }}"
            placeholder="votre@email.com"
            required
          />
          {% if form.email.errors %}
            <div class="label">
              {% for error in form.email.errors %}
                <span class="label-text-alt text-error">
                  <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
                </span>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <!-- Password -->
        <div class="form-control">
          <label class="label" for="{{ form.password1.id_for_label }}">
            <span class="label-text font-medium">
              <i class="fas fa-lock mr-2"></i>{{ form.password1.label }}
            </span>
          </label>
          <div class="relative">
            <input 
              id="{{ form.password1.id_for_label }}" 
              type="password" 
              name="{{ form.password1.name }}" 
              autocomplete="new-password" 
              class="input input-bordered w-full pr-12 {% if form.password1.errors %}input-error{% endif %}"
              placeholder="••••••••"
              minlength="8"
              required
            />
            <button 
              type="button" 
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-base-content/50 hover:text-base-content transition-colors"
              onclick="togglePassword('{{ form.password1.id_for_label }}')"
              aria-label="Afficher/masquer le mot de passe"
            >
              <i class="fas fa-eye" id="{{ form.password1.id_for_label }}-icon"></i>
            </button>
          </div>
          {% if form.password1.errors %}
            <div class="label">
              {% for error in form.password1.errors %}
                <span class="label-text-alt text-error">
                  <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
                </span>
              {% endfor %}
            </div>
          {% endif %}
          <!-- Password Help Text -->
          {% if form.password1.help_text %}
            <div class="label">
              <div class="label-text-alt text-info">
                <div class="text-xs space-y-1">
                  <ul class="list-disc list-inside space-y-1">
                    <li>Au minimum 8 caractères</li>
                    <li>Ne peut pas être entièrement numérique</li>
                    <li>Ne peut pas être un mot de passe couramment utilisé</li>
                    <li>Ne peut pas trop ressembler à vos autres informations</li>
                  </ul>
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        <!-- Confirm Password -->
        <div class="form-control">
          <label class="label" for="{{ form.password2.id_for_label }}">
            <span class="label-text font-medium">
              <i class="fas fa-lock mr-2"></i>{{ form.password2.label }}
            </span>
          </label>
          <div class="relative">
            <input 
              id="{{ form.password2.id_for_label }}" 
              type="password" 
              name="{{ form.password2.name }}" 
              autocomplete="new-password" 
              class="input input-bordered w-full pr-12 {% if form.password2.errors %}input-error{% endif %}"
              placeholder="••••••••"
              minlength="8"
              required
            />
            <button 
              type="button" 
              class="absolute right-3 top-1/2 transform -translate-y-1/2 text-base-content/50 hover:text-base-content transition-colors"
              onclick="togglePassword('{{ form.password2.id_for_label }}')"
              aria-label="Afficher/masquer le mot de passe"
            >
              <i class="fas fa-eye" id="{{ form.password2.id_for_label }}-icon"></i>
            </button>
          </div>
          {% if form.password2.errors %}
            <div class="label">
              {% for error in form.password2.errors %}
                <span class="label-text-alt text-error">
                  <i class="fas fa-exclamation-circle mr-1"></i>{{ error }}
                </span>
              {% endfor %}
            </div>
          {% endif %}
          <!-- Password Confirmation Help Text -->
          {% if form.password2.help_text %}
            <div class="label">
              <div class="label-text-alt text-info">
                <div class="text-xs">
                  <i class="fas fa-info-circle mr-1"></i>
                  Saisissez le même mot de passe que précédemment, pour vérification.
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        <!-- Terms and Conditions -->
        <div class="form-control">
          <label class="label cursor-pointer justify-start items-start">
            <input type="checkbox" class="checkbox checkbox-primary mr-3 mt-1" required>
            <div class="label-text text-sm">
              <div>J'accepte les 
                <a href="#" class="link link-primary">conditions d'utilisation</a>
              </div>
              <div>et la 
                <a href="#" class="link link-primary">politique de confidentialité</a>
              </div>
            </div>
          </label>
        </div>

        <!-- Submit Button -->
        <div class="form-control mt-6">
          <button 
            type="submit" 
            class="btn btn-primary w-full"
            id="register-btn"
          >
            <i class="fas fa-user-plus mr-2"></i>
            Créer mon compte
          </button>
        </div>
      </form>

      <!-- Divider -->
      <div class="divider">
        <span class="text-base-content/50">ou</span>
      </div>

      <!-- Login Link -->
      <div class="text-center">
        <p class="text-base-content/70 mb-3">
          Vous avez déjà un compte ?
        </p>
        <a 
          href="{% url 'users:login' %}" 
          class="btn btn-outline btn-primary w-full"
        >
          <i class="fas fa-sign-in-alt mr-2"></i>
          Se connecter
        </a>
      </div>

      <!-- Security Notice -->
      <div class="alert alert-info mt-4">
        <i class="fas fa-shield-alt"></i>
        <div>
          <div class="font-medium">Sécurité</div>
          <div class="text-sm">Vos données sont protégées par un chiffrement de niveau bancaire</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Toggle password visibility
function togglePassword(inputId) {
    const input = document.getElementById(inputId);
    const icon = document.getElementById(inputId + '-icon');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Password strength indicator and match validation
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
    const confirmInput = document.getElementById('{{ form.password2.id_for_label }}');
    
    function checkPasswordMatch() {
        if (confirmInput.value && passwordInput.value !== confirmInput.value) {
            confirmInput.setCustomValidity('Les mots de passe ne correspondent pas');
        } else {
            confirmInput.setCustomValidity('');
        }
    }
    
    passwordInput.addEventListener('input', checkPasswordMatch);
    confirmInput.addEventListener('input', checkPasswordMatch);
});
</script>
{% endblock %}